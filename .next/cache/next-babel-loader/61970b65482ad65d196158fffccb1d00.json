{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport Layout from '../components/main/layout';\nimport Head from 'next/head';\nimport Link from 'next/link';\nimport avatar from '../assets/avatar/avatar.png';\nimport styles from '../styles/account.module.scss';\nimport Cookies from 'js-cookie';\nimport { useEffect } from 'react';\nimport jwt from 'jsonwebtoken';\nimport dynamic from \"next/dynamic\";\nimport Router from 'next/router';\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var userdata = [];\n  {\n    /* Check if we have section named \"cookie\" in\n     the headers of the request that came to the server */\n  }\n\n  if (req.headers.cookie) {\n    {\n      /* Split the section \"cookie\" in dictionary */\n    }\n    var str = req.headers.cookie.split('; ');\n    var cookies = {};\n\n    for (var i = 0; i < str.length; i++) {\n      var cur = str[i].split('=');\n      cookies[cur[0]] = cur[1];\n    }\n\n    {\n      /* Check if the key 'token' exists in the cookie section */\n    }\n\n    if (cookies['token']) {\n      var d = new Date();\n      var now = Math.round(d.getTime() / 1000);\n      var expires = jwt.decode(cookies['token']).exp;\n      {\n        /* Check if the token is expired */\n      }\n\n      if (now >= expires) {\n        {\n          /* Imagine that this request has been done in the background from NextJS\n           What happens is that when the user tries to open the prefetched page\n           the redirect was already done. But the data is not there (That's the error).\n           So we check if the browser is present in the time when the request was made. So\n           we know that this was done in the background and we don't need to redirect. */\n        }\n\n        if (process.Browser !== undefined) {\n          res.setHeader(\"location\", \"/login\");\n          res.statusCode = 302;\n          res.end();\n        }\n      } else {\n        {\n          /* When the cookie token exists and it is not expired\n           we will fetch the data for the page */\n        }\n        var myHeaders = new Headers();\n        myHeaders.append(\"Authorization\", \"Bearer \" + cookies['token']);\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        var requestOptions = {\n          method: 'GET',\n          headers: myHeaders\n        };\n        const rest = await fetch(process.env.apiUrl + '/api/profiles/' + jwt.decode(cookies['token']).user_id, requestOptions);\n        userdata = await rest.json();\n      }\n    }\n  } else {\n    {\n      /* When the section cookie does not exists in the headers\n       and we checking the same thing from above for the redirect. */\n    }\n\n    if (process.Browser !== undefined) {\n      res.setHeader(\"location\", \"/login\");\n      res.statusCode = 302;\n      res.end();\n    }\n  }\n\n  return {\n    props: {\n      userdata\n    }\n  };\n}\nconst LoginPage = dynamic(() => import(\"./login\"), {\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak(\"./login\")],\n    modules: [\"./login\"]\n  }\n});\n\nfunction Account({\n  userdata\n}) {\n  if (Cookies.get('token')) {\n    var d = new Date();\n    var now = Math.round(d.getTime() / 1000);\n    var expires = jwt.decode(Cookies.get('token')).exp;\n\n    if (now >= expires) {\n      Cookies.remove('token');\n      Router.push('/login');\n    } else {\n      return __jsx(Layout, null, __jsx(Head, null, __jsx(\"title\", null, \"Host Rongo - Account\"), __jsx(\"script\", {\n        type: \"application/ld+json\",\n        dangerouslySetInnerHTML: {\n          __html: JSON.stringify({\n            \"@context\": \"https://schema.org/\",\n            \"@type\": \"BreadcrumbList\",\n            \"itemListElement\": [{\n              \"@type\": \"ListItem\",\n              \"position\": 1,\n              \"name\": \"Home\",\n              \"item\": \"http://bdf0a72fd508.ngrok.io/\"\n            }, {\n              \"@type\": \"ListItem\",\n              \"position\": 2,\n              \"name\": \"Account\",\n              \"item\": \"http://bdf0a72fd508.ngrok.io/account\"\n            }]\n          })\n        }\n      })), __jsx(\"div\", {\n        className: styles.Account\n      }, __jsx(\"div\", {\n        className: styles.Person\n      }, __jsx(\"div\", {\n        className: styles.Person_image\n      }, __jsx(\"img\", {\n        src: avatar\n      })), __jsx(\"h2\", null, userdata.first_name + \" \" + userdata.last_name), __jsx(\"div\", {\n        className: styles.Person_menu\n      }, __jsx(\"ul\", null, __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"Account\")), __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"Change Password\")), __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"Billing Address\")), __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"My Orders\")), __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"Private\")), __jsx(\"li\", null, __jsx(Link, {\n        href: \"/update\"\n      }, __jsx(\"a\", null, \"Update Account\"))), __jsx(\"li\", null, __jsx(\"a\", {\n        href: \"/\"\n      }, \"Delete Account\"))))), __jsx(\"div\", {\n        className: styles.Orders\n      }, __jsx(\"div\", {\n        className: styles.Orders_grid\n      }, __jsx(\"div\", {\n        className: styles.Main_row\n      }, __jsx(\"p\", null, \"Order\"), __jsx(\"p\", null, \"Name\"), __jsx(\"p\", null, \"Quontity\"), __jsx(\"p\", null, \"Price\"), __jsx(\"p\", null, \"Date\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\")), __jsx(\"div\", {\n        className: styles.Grid_row\n      }, __jsx(\"div\", null, \"123\"), __jsx(\"div\", null, \"Bluetooth Portable\"), __jsx(\"div\", null, \"2\"), __jsx(\"div\", null, \"$299\"), __jsx(\"div\", null, \"29.02\"))))));\n    }\n  } else {\n    useEffect(() => {\n      Router.push(\"/wtf\", \"/login\", {\n        shallow: true\n      });\n    });\n    return __jsx(LoginPage, null);\n  }\n}\n\nexport default Account;","map":null,"metadata":{},"sourceType":"module"}